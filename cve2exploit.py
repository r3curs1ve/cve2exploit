import json
import requests
import sys
import re


def main():
    if len(sys.argv) >= 1:
        matches = re.finditer(r"^CVE-\d{4}-\d{4,7}$", sys.argv[1])
        for matchNum, match in enumerate(matches, start=1):
            if matchNum == 1:
                search_exploit_bulletin(sys.argv[1])
        print("Error insert only cve id, eg. CVE-2017-0144")


def search_exploit_bulletin(CVE):
    """
    Looking for exploit bulletin from CVE
    :param CVE: ID of CVE
    """
    params = {"query": "cvelist:{} AND bulletinFamily:exploit".format(CVE)}
    print("Looking for bulletin exploit: {}".format(CVE))
    response = requests.get("https://vulners.com/api/v3/search/lucene/", params=params)
    response_json = json.loads(response.text)

    search = response_json["data"]["search"]

    for i in range(len(search)):
        title = search[i]["_source"]["title"]
        # desc = search[i]["_source"]["description"]
        shref = search[i]["_source"]["href"]
        vhref = search[i]["_source"]["vhref"]
        print("{}".format(title))
        # print(desc)
        if vhref != "":
            print("{}".format(vhref))
        if shref != "":
            print("{}".format(shref))
        print("")
    exit(0)


if __name__ == "__main__":
    main()
